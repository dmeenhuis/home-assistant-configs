start_spotify:
  alias: Start Spotify
  description: Start a Spotify playlist on Denon media player
  fields:
    playlist:
      description: The playlist URI from Spotify
      example: 37i9dQZF1DX4sWSpwq3LiO
  sequence:
    # - service: homeassistant.update_entity
    #   entity_id: media_player.spotify
    # - wait_template: '{{ source in state_attr("media_player.spotify", "source_list")  }}'
    #   timeout: 00:01:00
    #   continue_on_timeout: "false"

    # - delay:
    #     seconds: 12 # wait for the device to be properly started
    # - wait_template: '{{ is_state("media_player.denon_avr_x1300w", "on") }}'
    #   timeout: 00:01:00
    #   continue_on_timeout: "false"
    - service: media_player.play_media
      data_template:
        media_content_type: playlist
        media_content_id: spotify:playlist:{{ playlist }}
        entity_id: media_player.spotify
    - service: media_player.select_source
      data:
        entity_id: media_player.spotify
        source: "Denon AVR-X1300W"
